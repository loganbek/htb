<!--
 // Platform: Academy
// URL: https://academy.hackthebox.com/module/227/section/2496
// Platform Version: V1
// Module ID: 227
// Module Name: Introduction to Malware Analysis
// Module Difficulty: Hard
// Section ID: 2496
// Section Title: Debugging
// Page Title: Introduction to Malware Analysis
// Page Number: 07
-->

# Debugging

**Module Name:** Introduction to Malware Analysis **Page Number:** 07

#### INTRODUCTION TO MALWARE ANALYSIS

# Debugging

``` shell-session
[!bash!]$ xfreerdp /u:htb-student /p:'HTB_@cademy_stdnt!' /v:[Target IP] /dynamic-resolution
```

![https://academy.hackthebox.com/storage/modules/227/x64dbg_001_views.png](https://academy.hackthebox.com/storage/modules/227/x64dbg_001_views.png)

## Simulating Internet Services

``` shell-session
[!bash!]$ sudo nano /etc/inetsim/inetsim.conf
```

``` shell-session
service_bind_address <Our machine's/VM's TUN IP>
dns_default_ip <Our machine's/VM's TUN IP>
dns_default_hostname www
dns_default_domainname iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com
```

``` shell-session
[!bash!]$ sudo inetsim 
INetSim 1.3.2 (2020-05-19) by Matthias Eckert & Thomas Hungenberg
Using log directory:      /var/log/inetsim/
Using data directory:     /var/lib/inetsim/
Using report directory:   /var/log/inetsim/report/
Using configuration file: /etc/inetsim/inetsim.conf
Parsing configuration file.
Configuration file parsed successfully.
=== INetSim main process started (PID 34711) ===
Session ID:     34711
Listening on:   0.0.0.0
Real Date/Time: 2023-06-11 00:18:44
Fake Date/Time: 2023-06-11 00:18:44 (Delta: 0 seconds)
 Forking services...
  * dns_53_tcp_udp - started (PID 34715)
  * smtps_465_tcp - started (PID 34719)
  * pop3_110_tcp - started (PID 34720)
  * smtp_25_tcp - started (PID 34718)
  * http_80_tcp - started (PID 34716)
  * ftp_21_tcp - started (PID 34722)
  * https_443_tcp - started (PID 34717)
  * pop3s_995_tcp - started (PID 34721)
  * ftps_990_tcp - started (PID 34723)
 done.
Simulation running.
```

![https://academy.hackthebox.com/storage/modules/227/point_.png](https://academy.hackthebox.com/storage/modules/227/point_.png)

## Applying the Patches to Bypass Sandbox Checks

### By Copying the Address from IDA

``` ida
.text:00000000004032C8                 cmp     [rsp+148h+Type], 1
```

![https://academy.hackthebox.com/storage/modules/227/ida_027_addresscp.png](https://academy.hackthebox.com/storage/modules/227/ida_027_addresscp.png)

### By Searching Through the Strings.

![https://academy.hackthebox.com/storage/modules/227/x64dbg_002_strings_.png](https://academy.hackthebox.com/storage/modules/227/x64dbg_002_strings_.png)

![https://academy.hackthebox.com/storage/modules/227/x64dbg_002_strings__.png](https://academy.hackthebox.com/storage/modules/227/x64dbg_002_strings__.png)

![https://academy.hackthebox.com/storage/modules/227/x64dbg_003_cmp.png](https://academy.hackthebox.com/storage/modules/227/x64dbg_003_cmp.png)

![https://academy.hackthebox.com/storage/modules/227/x64dbg_004_assemble_patch1.png](https://academy.hackthebox.com/storage/modules/227/x64dbg_004_assemble_patch1.png)

![https://academy.hackthebox.com/storage/modules/227/x64dbg_004_patch1.png](https://academy.hackthebox.com/storage/modules/227/x64dbg_004_patch1.png)

![https://academy.hackthebox.com/storage/modules/227/x64dbg_005_patch2.png](https://academy.hackthebox.com/storage/modules/227/x64dbg_005_patch2.png)

![https://academy.hackthebox.com/storage/modules/227/x64dbg_006_jne.png](https://academy.hackthebox.com/storage/modules/227/x64dbg_006_jne.png)

![https://academy.hackthebox.com/storage/modules/227/patch3.png](https://academy.hackthebox.com/storage/modules/227/patch3.png)

![https://academy.hackthebox.com/storage/modules/227/patch3_.png](https://academy.hackthebox.com/storage/modules/227/patch3_.png)

![https://academy.hackthebox.com/storage/modules/227/both_messagebox.png](https://academy.hackthebox.com/storage/modules/227/both_messagebox.png)

![https://academy.hackthebox.com/storage/modules/227/patch3__.png](https://academy.hackthebox.com/storage/modules/227/patch3__.png)

## Analyzing Malware Traffic

![https://academy.hackthebox.com/storage/modules/227/wireshark_request.png](https://academy.hackthebox.com/storage/modules/227/wireshark_request.png)

![https://academy.hackthebox.com/storage/modules/227/wireshark_response.png](https://academy.hackthebox.com/storage/modules/227/wireshark_response.png)

![https://academy.hackthebox.com/storage/modules/227/wireshark_dns.png](https://academy.hackthebox.com/storage/modules/227/wireshark_dns.png)

## Analyzing Process Injection & Memory Region

![https://academy.hackthebox.com/storage/modules/227/x64dbg_008_bp_wpm.png](https://academy.hackthebox.com/storage/modules/227/x64dbg_008_bp_wpm.png)

### Attaching Another Running Process In x64dbg

![https://academy.hackthebox.com/storage/modules/227/x64dbg_009_attach.png](https://academy.hackthebox.com/storage/modules/227/x64dbg_009_attach.png)

![https://academy.hackthebox.com/storage/modules/227/msdn_002_writeprocessmemory.png](https://academy.hackthebox.com/storage/modules/227/msdn_002_writeprocessmemory.png)

![https://academy.hackthebox.com/storage/modules/227/x64dbg_010_register_wpm.png](https://academy.hackthebox.com/storage/modules/227/x64dbg_010_register_wpm.png)

![https://academy.hackthebox.com/storage/modules/227/x64dbg_011_shellcode_write.png](https://academy.hackthebox.com/storage/modules/227/x64dbg_011_shellcode_write.png)

![https://academy.hackthebox.com/storage/modules/227/x64dbg_shellcodecopy_.png](https://academy.hackthebox.com/storage/modules/227/x64dbg_shellcodecopy_.png)

# 

# 

#### Questions

####